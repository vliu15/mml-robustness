"""Generates all MTL task ablation plots."""

import argparse
import logging
import logging.config
import os
from typing import List

import matplotlib.pyplot as plt
import pandas as pd
import seaborn as sns

logging.config.fileConfig("logger.conf")
logger = logging.getLogger(__name__)


stl_erm_disjoint = {
    "Big_Lips:Chubby": [(69.94, (69.57,70.3)), (11.01, (10.56,11.46)), (68.32, (67.94,68.69)), (41.24, (40.53,41.95))],
    "Bushy_Eyebrows:Blond_Hair":
        [(92.6, (92.39,92.81)), (13.64, (5.36,21.92)), (90.8, (90.57,91.03)), (27.04, (16.94,37.15))],
    "Wearing_Lipstick:Male":
        [(93.49, (93.3,93.69)), (36.72, (28.78,44.65)), (92.68, (92.47,92.89)), (49.66, (41.63,57.7))],
    "Gray_Hair:Young": [(98.16, (98.05,98.26)), (25.0, (15.0,35.0)), (97.95, (97.84,98.06)), (15.32, (7.09,23.55))],
    "High_Cheekbones:Smiling":
        [(87.39, (87.12,87.65)), (38.24, (36.79,39.69)), (84.3, (84.01,84.6)), (50.03, (48.6,51.47))],
    "Brown_Hair:Wearing_Hat":
        [(88.68, (88.42,88.93)), (22.77, (13.49,32.05)), (86.49, (86.21,86.76)), (38.46, (27.66,49.26))],
    "No_Beard:Wearing_Lipstick":
        [(96.05, (95.9,96.21), (20.0, (0.0,40.24)), (94.65, (94.47,94.83)), (0.0, (0.0,0.0))],
    "Young:Chubby": [(88.01, (87.75,88.27)), (63.12, (62.26,63.98)), (85.97, (85.69,86.25)), (66.57, (65.56,67.58))],
    "Bangs:Wearing_Hat": [(95.93, (95.77,96.08)), (63.16, (50.64,75.68)), (95.55, (95.38,95.71)), (77.36, (66.71,88.01))],
    "Pointy_Nose:Heavy_Makeup":
        [(77.34, (77.01,77.68)), (20.21, (19.25,21.18)), (72.46, (72.1,72.81)), (35.24, (34.09,36.39))]
}

stl_erm_full_task_ablation = {
    "Arched_Eyebrows:Male":
        [(83.79, (83.5,84.09)), (35.0, (32.41,37.58)), (80.62, (80.3,80.93)), (50.47, (47.77,53.18))],
    "Big_Nose:Male": [(83.98, (83.69,84.28)), (35.18, (33.68,36.68)), (79.52, (79.2,79.85)), (46.68, (45.12,48.24))],
    "Blond_Hair:Male": [(95.8, (95.64,95.97)), (42.58, (38.41,46.75)), (95.18, (95.01,95.35)), (43.33, (39.15,47.5))],
    "Wearing_Earrings:Male":
        [(90.38, (90.14,90.62)), (32.67, (28.74,36.6)), (88.66, (88.41,88.92)), (42.28, (38.14,46.42))] 
}

stl_erm_nondisjoint = {
    "Wearing_Earrings:Male": [
        (90.38, (90.14,90.62)), (32.67, (28.74,36.6)), (88.66, (88.41,88.92)), (42.28, (38.14,46.42)) 
    ],
    "Attractive:Male": [
        (82.18, (81.87,82.48)),
        (66.11, (65.21,67.02)),
        (79.76, (79.44,80.08)),
        (65.62, (64.39,66.85)),
    ],
    "No_Beard:Heavy_Makeup": [
        (96.05, (95.9,96.21)),
        (28.99, (12.0,45.98)),
        (89.7, (89.45,89.94)),
        (0.0, (0.0,0.0)),
    ],
    "Pointy_Nose:Heavy_Makeup":
        [
            (77.34, (77.01,77.68)),
            (20.21, (19.25,21.18)),
            (72.46, (72.1,72.81)),
            (35.24, (34.09,36.39)),
        ],
    "Attractive:Gray_Hair": [
        (82.2, (81.9,82.51)),
        (38.69, (25.76,51.63)),
        (80.67, (80.35,80.98)),
        (50.0, (36.72,63.28)),
    ],
    "Big_Nose:Gray_Hair": [
        (84.0, (83.71,84.29)),
        (53.86, (52.77,54.95)),
        (80.52, (80.21,80.84)),
        (56.93, (55.48,58.39)),
    ],
    "Heavy_Makeup:Wearing_Lipstick":
        [(91.34, (91.11,91.56)), (31.19, (26.76,35.62)), (90.58, (90.34,90.81)), (33.26, (28.76,37.77))],
    "No_Beard:Wearing_Lipstick":
        [
            (96.05, (95.9,96.21)),
            (20.0, (0,40.24)),
            (94.65, (94.47,94.83)),
            (0.0, (0.0,0.0)),
        ],
    "Bangs:Wearing_Hat": [
        (95.93, (95.77,96.08)),
        (63.16, (50.64,75.68)),
        (95.55, (95.38,95.71)),
        (77.36, (66.71,88.01)),
    ],
    "Blond_Hair:Wearing_Hat": [
        (95.86, (95.7,96.02)), (35.71, (20.72,50.71)), (94.93, (94.76,95.11)), (48.72, (33.07,64.36))
    ]
}

mtl_erm_disjoint_ablate = {
    2:
        [
            {
                "Big_Lips:Chubby": [(70.6, (70.24,70.97)), (15.35, (14.84,15.87)), (66.92, (66.54,67.29)), (59.01, (58.4,59.61))],
                "Bushy_Eyebrows:Blond_Hair": [(92.76, (92.55,92.97)), (11.75, (4.0,19.49)), (88.63, (88.37,88.88)), (39.17, (28.13,50.2))]
            }, {
                "Bushy_Eyebrows:Blond_Hair": [(92.87, (92.66,93.08)), (10.27, (2.96,17.58)), (89.06, (88.81,89.31)), (43.75, (31.86,55.63))],
                "High_Cheekbones:Smiling": [(87.76, (87.5,88.02)), (37.92, (36.47,39.37)), (85.1, (84.82,85.39)), (51.9, (50.47,53.33))],
            }
        ],
    3:
        [
            {
                "Big_Lips:Chubby":
                    [(71.1, (70.74,71.46)), (16.03, (15.5,16.56)), (68.3, (67.93,68.67)), (50.25, (49.53,50.97))],
                "Bushy_Eyebrows:Blond_Hair":
                    [(92.78, (92.57,92.99)), (13.64, (5.36,21.92)), (89.49, (89.24,89.73)), (42.25, (30.41,54.09))],
                "Wearing_Lipstick:Male":
                    [(93.87, (93.67,94.06)), (30.37, (22.79,37.95)), (93.39, (93.2,93.59)), (40.9, (32.83,48.98))],
            }, {
                "Big_Lips:Chubby": [(70.97, (70.61,71.34)), (17.28, (16.74,17.83)), (66.25, (65.87,66.63)), (57.8, (57.19,58.41))],
                "Bushy_Eyebrows:Blond_Hair": [(92.72, (92.51,92.92)), (10.27, (2.96,17.58)), (90.55, (90.31,90.78)), (24.82, (14.49,35.15))],
                "Gray_Hair:Young": [(98.15, (98.04,98.26)), (27.47, (17.2,37.75)), (97.51, (97.39,97.64)), (38.72, (27.51,49.93))]
            }, {
                "Big_Lips:Chubby": [(71.24, (70.88,71.61)), (17.47, (16.92, 18.02)), (66.88, (66.5,67.26)), (53.71, (53.0,54.43))],
                "Bushy_Eyebrows:Blond_Hair": [(92.77, (92.57,92.98)), (13.64, (5.36,21.92)), (88.65, (88.4,88.91), (48.7, (37.58,59.82)],
                "High_Cheekbones:Smiling": [(87.56, (87.3,87.83)), (41.31, (39.84,42.78)), (85.07, (84.79,85.36)), (54.55, (53.12,55.98))]
            }, {
                "Bushy_Eyebrows:Blond_Hair": [(92.81, (92.61,93.02)), (13.64, (5.36,21.92)), (90.2, (89.96,90.44)), (34.63, (23.2,46.07))],
                "High_Cheekbones:Smiling": [(87.94, (87.67,88.2)), (39.72, (38.26,41.18)), (85.25, (84.96,85.53)), (51.68, (50.35,53.01))],
                "Wearing_Lipstick:Male": [(93.91, (93.72,94.1)), (33.32, (25.54,41.1)), (93.24, (93.04,93.44)), (43.86, (35.71,52.0))]
            }, {
                "Bushy_Eyebrows:Blond_Hair": [(92.88, (92.67,93.08)), (14.93, (6.34,23.51)), (89.52, (89.27,89.76)), (37.09, (25.6,48.59))],
                "High_Cheekbones:Smiling": [(87.62, (87.35,87.88)), (44.31, (42.83,45.79)), (84.53, (84.24,84.82)), (52.35, (50.97,53.73))],
                "Brown_Hair:Wearing_Hat": [(89.0, (88.75,89.25)), (19.73, (10.96,28.5)), (85.08, (84.8,85.37)), (29.28, (21.24,37.31))]
            }, {
                "Bushy_Eyebrows:Blond_Hair": [(92.73, (92.53,92.94)), (11.75, (4.0,19.49)), (89.5, (89.26,89.75)), (39.83, (28.28,51.39))],
                "High_Cheekbones:Smiling": [(87.86, (87.6,88.12)), (40.37, (38.91,41.84)), (84.86, (84.58,85.15)), (51.97, (50.64,53.31))],
                "Gray_Hair:Young": [(98.16, (98.05,98.27)), (29.17, (18.67,39.67)), (97.52, (97.39,97.64)), (32.83, (22.25,43.41))]
            }
        ],
    4:
        [
            {
                "Big_Lips:Chubby":
                    [(71.22, (70.85,71.58)), (17.55, (17.0,18.1)), (66.96, (66.58,67.33)), (53.64, (52.92,54.36))],
                "Bushy_Eyebrows:Blond_Hair":
                    [(92.7, (92.5,92.91)), (12.74, (4.75,20.74)), (89.45, (89.21,89.7)), (39.06, (27.38,50.75))],
                "Wearing_Lipstick:Male":
                    [(93.94, (93.75,94.13)), (31.08, (23.45,38.7)), (93.72, (93.53,93.92)), (39.65, (31.59,47.71))],
                "Gray_Hair:Young":
                    [(98.22, (98.11,98.32)), (27.69, (17.36,38.01)), (97.59, (97.47,97.72)), (36.47, (26.23,46.71))],
            }, {
                "Big_Lips:Chubby": [(71.56, (71.2,71.92)), (19.5, (18.93,20.07)), (67.15, (66.78,67.53)), (52.11, (51.39,52.83))],
                "Bushy_Eyebrows:Blond_Hair": [(92.73, (92.52,92.94)), (13.51, (5.36,21.66)), (88.15, (87.9,88.41)), (43.74, (31.92,55.56))],
                "Gray_Hair:Young": [(98.19, (98.08,98.29)), (26.3, (16.14,36.46)), (97.89, (97.77,98.0)), (32.69, (21.95,43.44))],
                "High_Cheekbones:Smiling": [(87.67, (87.41,87.94), (37.71, (36.26,39.17)), (85.3, (85.02,85.59)), (50.23, (48.9,51.57))],
            }, {
                "Big_Lips:Chubby": [(71.52, (71.16,71.88)), (18.11, (17.56,18.67)), (67.91, (67.54,68.28)), (54.07, (53.35,54.78))],
                "Bushy_Eyebrows:Blond_Hair": [(92.75, (92.54,92.96)), (12.74, (4.75,20.74)), (89.83, (89.59,90.08), (32.97, (22.09,43.84))],
                "High_Cheekbones:Smiling": [(87.7, (87.44,87.97)), (39.0, (37.54,40.46)), (85.16, (84.88,85.45)), (52.45, (51.07,53.83))],
                "Wearing_Lipstick:Male": [(94.05, (93.86,94.24)), (29.59, (22.08,37.11)), (93.49, (93.29,93.68)), (46.07, (37.86,54.29))],
            }, {
                "Bushy_Eyebrows:Blond_Hair": [(92.86, (92.65,93.07)), (13.64, (5.36,21.92)), (88.93, (88.68,89.18)), (30.84, (19.84,41.83))],
                "High_Cheekbones:Smiling": [(87.86, (87.59,88.12)), (36.28, (34.84,37.71)), (84.61, (84.32,84.9)), (49.9, (48.56,51.23))],
                "Wearing_Lipstick:Male": [(93.7, (93.51,93.9)), (30.23, (22.68,37.79)), (93.26, (93.06,93.46)), (36.73, (28.94,44.53))],
                "Gray_Hair:Young": [(98.19, (98.09,98.3)), (30.49, (19.86,41.11)), (97.75, (97.63,97.87)), (32.69, (21.95,43.44))],
            }, {
                "Bushy_Eyebrows:Blond_Hair": [(92.72, (92.51,92.92)), (13.64, (5.36,21.92)), (88.27, (88.01,88.53)), (50.24, (38.42,62.06))],
                "High_Cheekbones:Smiling": [(87.64, (87.38,87.9)), (38.72, (37.26,40.17)), (84.84, (84.55,85.12)), (52.15, (50.77,53.53))],
                "Brown_Hair:Wearing_Hat": [(88.97, (88.72,89.23)), (17.45, (9.06,25.84)), (85.28, (84.99,85.56)), (32.77, (22.45,43.09))],
                "Big_Lips:Chubby": [(71.43, (71.07,71.79)), (19.49, (18.92,20.06)), (65.94, (65.57,66.32)), (58.31, (57.7,58.92))],
            }, {
                "Bushy_Eyebrows:Blond_Hair": [(92.78, (92.57,92.99)), (11.75, (4.0,19.49)), (89.82, (89.57,90.06)), (34.6, (23.57,45.64))],
                "High_Cheekbones:Smiling": [(87.77, (87.51,88.03)), (37.54, (36.09,38.99)), (85.2, (84.92,85.49)), (51.37, (49.99,52.75))],
                "Gray_Hair:Young": [(98.18, (98.08,98.29)), (30.49, (19.86,41.11)), (97.12, (96.99,97.26)), (41.67, (30.28,53.05))],
                "Brown_Hair:Wearing_Hat": [(89.07, (88.82,89.32)), (17.53, (9.2,25.85)), (85.84, (85.56,86.11)), (47.89, (37.18,58.59))],
            }
        ],
    # 5:
    #     {
    #         "Big_Lips:Chubby":
    #             [(71.8, (71.43, 72.16)), (20.88, (20.29, 21.47)), (67.15, (66.77, 67.52)), (53.51, (52.79, 54.23))],
    #         "Bushy_Eyebrows:Blond_Hair":
    #             [(92.75, (92.54, 92.95)), (12.77, (4.94, 20.6)), (89.57, (89.33, 89.82)), (44.27, (32.62, 55.92))],
    #         "Wearing_Lipstick:Male":
    #             [(93.94, (93.75, 94.13)), (31.7, (24.13, 39.28)), (93.32, (93.12, 93.52)), (35.16, (27.38, 42.93))],
    #         "Gray_Hair:Young":
    #             [(98.14, (98.03, 98.25)), (26.27, (16.36, 36.17)), (97.68, (97.56, 97.8)), (30.22, (19.89, 40.56))],
    #         "High_Cheekbones:Smiling":
    #             [(87.83, (87.57, 88.1)), (37.7, (36.25, 39.15)), (84.4, (84.11, 84.69)), (51.21, (49.88, 52.55))],
    #     },
    # 6:
    #     {
    #         "Big_Lips:Chubby":
    #             [(70.73, (70.37, 71.1)), (14.14, (13.64, 14.64)), (67.43, (67.06, 67.81)), (53.91, (53.19, 54.63))],
    #         "Bushy_Eyebrows:Blond_Hair":
    #             [(92.63, (92.43, 92.84)), (14.2, (6.02, 22.39)), (88.55, (88.29, 88.8)), (41.41, (29.86, 52.96))],
    #         "Wearing_Lipstick:Male":
    #             [(93.6, (93.4, 93.79)), (34.47, (26.73, 42.21)), (93.44, (93.24, 93.64)), (43.44, (35.37, 51.51))],
    #         "Gray_Hair:Young":
    #             [(98.17, (98.06, 98.28)), (27.58, (17.53, 37.64)), (97.16, (97.03, 97.29)), (44.73, (33.54, 55.92))],
    #         "High_Cheekbones:Smiling":
    #             [(87.69, (87.42, 87.95)), (39.03, (37.57, 40.49)), (85.57, (85.29, 85.85)), (52.27, (50.94, 53.6))],
    #         "Brown_Hair:Wearing_Hat":
    #             [(88.57, (88.31, 88.82)), (17.01, (8.87, 25.15)), (85.62, (85.34, 85.9)), (47.56, (36.74, 58.38))],
    #     },
}

mtl_erm_nondisjoint_ablate = {
    2:
        [
            {
                "Arched_Eyebrows:Male": [(84.12, (83.83,84.41)), (35.16, (32.57,37.75)), (80.5, (80.18,80.82)), (57.14, (54.47,59.81))],
                "Big_Nose:Male": [(84.32, (84.03,84.61)), (35.33, (33.83,36.82)), (79.21, (78.89,79.54)), (53.49, (51.93,55.06))]
            }, {
                "Blond_Hair:Male": [(95.76, (95.6,95.92)), (40.18, (36.04,44.31)), (94.84, (94.66,95.01)), (54.66, (50.5,58.82))],
                "Wearing_Earrings:Male": [(90.73, (90.5,90.96)), (32.16, (28.25,36.08)), (88.95, (88.7,89.21)), (56.63, (52.48,60.78))]
            }
        ],
    3:
        [
            {
                "Arched_Eyebrows:Male": [(84.28, (83.99,84.58)), (34.84, (32.27,37.42)), (80.5, (80.19,80.82)), (53.48, (50.78,56.18))],
                "Big_Nose:Male": [(84.64, (84.35,84.93)), (32.59, (31.12,34.06)), (78.91, (78.58,79.23), (58.67, (57.12,60.21))],
                "Wearing_Earrings:Male": [(90.84, (90.6,91.07)), (35.09, (31.09,39.08)), (88.58, (88.33,88.84)), (48.76, (44.6,52.91))]
            }, {
                "Arched_Eyebrows:Male": [(84.17, (83.88,84.46)), (34.5, (31.93,37.08)), (80.33, (80.01,80.65)), (55.3, (52.61,57.99))],
                "Big_Nose:Male": [(84.4, (84.11,84.69)), (35.89, (34.38,37.39)), (78.55, (78.22,78.88)), (60.05, (58.93,61.16))],
                "Wearing_Lipstick:Male": [(93.92, (93.73,94.11)), (28.93, (21.46,36.4), (93.33, (93.13,93.53)), (41.79, (33.66,49.92))]
            }, {
                "Arched_Eyebrows:Male": [(84.29, (84.0,84.58)), (35.47, (32.88,38.06)), (80.6, (80.28,80.91)), (57.6, (54.93,60.27))],
                "Big_Nose:Male": [(84.5, (84.21,84.79)), (34.1, (32.62,35.59)), (78.16, (77.82,78.49)), (58.79, (57.25,60.34))],
                "Attractive:Male": [(82.67, (82.37,82.98)), (66.66, (65.63,67.69)), (79.35, (79.02,79.67)), (69.3, (68.3,70.31))]
            }, {
                "Blond_Hair:Male": [(95.89, (95.73,96.05)), (43.29, (39.14,47.43)), (94.23, (94.04,94.42)), (64.86, (60.86,68.86))],
                "Wearing_Earrings:Male": [(90.83, (90.6,91.06)), (34.76, (30.77,38.75)), (88.4, (88.14,88.65)), (52.41, (48.22,56.59))],
                "Wearing_Lipstick:Male": [(93.86, (93.67,94.06)), (35.37, (27.49,43.25)), (93.47, (93.27,93.67)), (41.68, (33.59,49.77))]
            }, {
                "Blond_Hair:Male": [(95.93, (95.77,96.09)), (44.06, (39.87,48.24)), (94.45, (94.26,94.63)), (55.24, (51.05,59.42))],
                "Wearing_Earrings:Male": [(90.65, (90.42,90.89)), (34.31, (30.34,38.27)), (89.17, (88.92,89.42)), (50.37, (46.19,54.56))],
                "Big_Nose:Male": [(84.4, (84.11,84.69)), (33.11, (31.64,34.59)), (78.4, (78.07,78.73)), (58.38, (56.83,59.92))]
            }, {
                "Blond_Hair:Male": [(95.94, (95.78,96.1)), (42.74, (38.58,46.91)), (94.28, (94.09,94.47)), (59.1, (54.97,63.22))],
                "Wearing_Earrings:Male": [(90.7, (90.47,90.93)), (35.74, (31.73,39.75)), (87.82, (87.56,88.09)), (53.94, (49.78,58.11))],
                "Arched_Eyebrows:Male": [(84.09, (83.8,84.38)), (35.69, (33.11,38.28)), (79.93, (79.61,80.25)), (559.48, (56.82,62.14))]
            }
        ],
    4:
        [
            {
                "Arched_Eyebrows:Male": [(84.15, (83.86,84.44)), (32.19, (29.67,34.71)), (79.72, (79.4,80.04)), (54.55, (51.86,57.25)],
                "Big_Nose:Male": [(84.63, (84.35,84.92)), (34.51, (33.02,36.0)), (78.98, (78.65,79.3)), (56.7, (55.15,58.26))],
                "Wearing_Earrings:Male": [(90.78, (90.55,91.01)), (31.03, (27.16,34.89)), (88.03, (87.77,88.29)), (59.45, (55.34,63.56))],
                "Blond_Hair:Male": [(95.9, (95.74,96.05)), (42.02, (37.86,46.18)), (94.22, (94.03,94.4)), (60.27, (56.15,64.39))]
            }, {
                "Arched_Eyebrows:Male": [(84.16, (83.86,84.45)), (334.68, (32.12,37.24)), (80.86, (80.55,81.18)), (55.6, (52.91,58.29))],
                "Big_Nose:Male": [(84.61, (84.32,84.9)), (36.91, (35.4,38.41)), (78.6, (78.27,78.93)), (57.55, (56.02,59.09))],
                "Wearing_Lipstick:Male": [(93.48, (93.28,93.67), (30.42, (22.83,38.0)), (93.29, (93.09,93.49)), (43.23, (35.06,51.39))],
                "Wearing_Earrings:Male": [(90.8, (90.57,91.04)), (28.27, (24.5,32.04)), (88.37, (88.12,88.63)), (48.51, (44.33,52.69))]
            }, {
                "Arched_Eyebrows:Male": [(84.08, (83.79,84.37)), (40.17, (37.53,42.82)), (80.28, (79.96,80.6)), (60.39, (59.32,61.47))],
                "Big_Nose:Male": [(84.82, (84.54,85.11)), (35.36, (33.86,36.86)), (78.46, (78.13,78.79)), (56.74, (55.19,58.29))],
                "Attractive:Male": [(82.7, (82.39,83.0)), (67.98, (66.96,68.99)), (79.36, (79.04,79.69)), (69.87, (68.99,70.75))],
                "Blond_Hair:Male": [(95.9, (95.74,96.06)), (43.95, (39.8,48.11)), (94.59, (94.4,94.77)), (55.8, (51.63,59.98))]
            }, {
                "Blond_Hair:Male": [(95.85, (95.7,96.01)), (42.4, (38.23,46.56)), (94.2, (94.01,94.39)), (59.36, (55.25,63.46))],
                "Wearing_Earrings:Male": [(90.65, (90.42,90.89)), (29.81, (25.99,33.63)), (88.56, (88.3,88.81)), (60.26, (56.19,64.33))],
                "Wearing_Lipstick:Male": [(93.75, (93.56,93.95), (37.31, (29.38,45.25)), (93.42, (93.23,93.62)), (552.48, (44.24,60.73))],
                "Arched_Eyebrows:Male": [(84.01, (83.71,84.3)), (338.13, (35.5,40.75), (82.14, (81.83,82.44)), (53.68, (50.98,56.38))]
            }, {
                "Blond_Hair:Male": [(95.96, (95.8,96.12)), (41.05, (36.91,45.19)), (94.37, (94.18,94.55)), (60.5, (56.41,64.58))],
                "Wearing_Earrings:Male": [(90.71, (90.48,90.94)), (31.24, (27.36,35.11)), (87.32, (87.05,87.58)), (53.9, (49.76,58.04)],
                "Big_Nose:Male": [(84.44, (84.15,84.73)), (37.02, (35.5,38.54)), (78.23, (77.9,78.56)), (58.91, (57.37,60.45))],
                "Attractive:Male": [(82.78, (82.48,83.08)), (66.62, (65.59,67.64)), (78.6, (78.27,78.93)), (70.81, (69.82,71.8))]
            }, {
                "Blond_Hair:Male": [(95.89, (95.74,96.05)), (43.3, (39.12,47.47)), (94.54, (94.36,94.72)), (58.18, (54.03,62.34))],
                "Wearing_Earrings:Male": [(90.76, (90.52,90.99)), (40.04, (35.94,44.14)), (88.21, (87.95,88.46)), (57.98, (53.85,62.1))],
                "Arched_Eyebrows:Male": [(84.0, (83.71,84.29)), (39.19, (36.55,41.82)), (81.65, (81.34,81.96)), (57.56, (54.88,60.23))],
                "Big_Nose:Male": [(84.7, (84.41,84.99))), (34.12, (32.64,35.61)), (79.69, (79.37,80.01)), (54.28, (52.72,55.84))]
            }
        ]
}

STL_ENTRIES = {**stl_erm_disjoint, **stl_erm_nondisjoint, **stl_erm_full_task_ablation}


def parse_args():
    parser = argparse.ArgumentParser()
    parser.add_argument("--out_dir", type=str, default="./outputs/iclr_submission", help="Output directory of ablation plots")
    return parser.parse_args()


def get_n_mtl_task_ablation_average_performances(n, average_type: str):
    if average_type == "disjoint":
        mtl_entries = mtl_erm_disjoint_ablate[n]
    elif average_type == "nondisjoint":
        mtl_entries = mtl_erm_nondisjoint_ablate[n]
    elif average_type == "all":
        mtl_entries = mtl_erm_disjoint_ablate[n] + mtl_erm_nondisjoint_ablate[n]

    mtl_from_avg_accs, mtl_from_wg_accs = [], []
    stl_from_avg_accs, stl_from_wg_accs = [], []
    for entry in mtl_entries:
        for task, (_, wg_from_avg, _, wg_from_wg) in entry.items():
            # TODO currently throwing away CI
            wg_from_avg, _ = wg_from_avg
            wg_from_wg, _ = wg_from_wg

            # Grab MTL values
            mtl_from_avg_accs.append(wg_from_avg)
            mtl_from_wg_accs.append(wg_from_wg)

            # We want to grab the STL values for the exact task
            _, wg_from_avg, _, wg_from_wg = STL_ENTRIES[task]
            # TODO currently throwing away CI
            wg_from_avg, _ = wg_from_avg
            wg_from_wg, _ = wg_from_wg

            stl_from_avg_accs.append(wg_from_avg)
            stl_from_wg_accs.append(wg_from_wg)

    mtl_from_avg_accs = sum(mtl_from_avg_accs) / len(mtl_from_avg_accs)
    mtl_from_wg_accs = sum(mtl_from_wg_accs) / len(mtl_from_wg_accs)
    stl_from_avg_accs = sum(stl_from_avg_accs) / len(stl_from_avg_accs)
    stl_from_wg_accs = sum(stl_from_wg_accs) / len(stl_from_wg_accs)
    return mtl_from_avg_accs, mtl_from_wg_accs, stl_from_avg_accs, stl_from_wg_accs


def get_mtl_task_ablation_average_performances(average_type: str, save_name: str):
    """Computes the individual average task performances from MTL and STL"""
    assert average_type in ["disjoint", "nondisjoint", "all"]
    x = list(range(2, 5))

    mtl_from_avg_accs = {}
    mtl_from_wg_accs = {}
    stl_from_avg_accs = {}
    stl_from_wg_accs = {}

    for n in x:
        mtl_from_avg_accs[n], mtl_from_wg_accs[n], stl_from_avg_accs[n], stl_from_wg_accs[n] = \
            get_n_mtl_task_ablation_average_performances(n, average_type)

    data = pd.DataFrame(
        {
            "# Tasks": x,
            "MTL: Mean of WG Acc (Avg Ckpt)": [mtl_from_avg_accs[k] for k in x],
            "MTL: Mean of WG Acc (WG Ckpt": [mtl_from_wg_accs[k] for k in x],
            "STL: Mean of WG Acc (Avg Ckpt)": [stl_from_avg_accs[k] for k in x],
            "STL: Mean of WG Acc (WG Ckpt)": [stl_from_wg_accs[k] for k in x],
        }
    )

    plt.clf()
    plt.cla()
    ax = sns.lineplot(
        x="# Tasks",
        y="Accuracy",
        hue="hue",
        data=pd.melt(
            data,
            id_vars=["# Tasks"],
            value_vars=[
                "MTL: Mean of WG Acc (Avg Ckpt)",
                "MTL: Mean of WG Acc (WG Ckpt",
                "STL: Mean of WG Acc (Avg Ckpt)",
                "STL: Mean of WG Acc (WG Ckpt)",
            ],
            value_name="Accuracy",
            var_name="hue"
        )
    )
    ax.set_title(f"MTL Task Ablation: {average_type.upper()}")
    ax.set_xticks(x)
    plt.grid()
    plt.tight_layout()
    plt.savefig(save_name)


def main():
    args = parse_args()
    os.makedirs(args.out_dir, exist_ok=True)

    logger.info("Creating MTL Disjoint Ablation plot")
    get_mtl_task_ablation_average_performances(
        average_type="disjoint",
        save_name=os.path.join(args.out_dir, "mtl_disjoint_ablate.png"),
    )
    logger.info("Creating MTL Non-Disjoint Ablation plot")
    get_mtl_task_ablation_average_performances(
        average_type="nondisjoint",
        save_name=os.path.join(args.out_dir, "mtl_nondisjoint_ablate.png"),
    )
    logger.info("Creating MTL Disjoint + Non-Disjoint Ablation plot")
    get_mtl_task_ablation_average_performances(
        average_type="all",
        save_name=os.path.join(args.out_dir, "mtl_all_ablate.png"),
    )


if __name__ == "__main__":
    main()
